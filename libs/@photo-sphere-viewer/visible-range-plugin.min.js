/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@photo-sphere-viewer/visible-range-plugin@5.10.1/index.module.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*!
 * Photo Sphere Viewer / Visible Range Plugin 5.10.1
 * @copyright 2015-2024 Damien "Mistic" Sorel
 * @licence MIT (https://opensource.org/licenses/MIT)
 */
import{AbstractConfigurablePlugin,events,utils}from"@photo-sphere-viewer/core";import{MathUtils}from"three";var EPS=1e-6,getConfig=utils.getConfigParser({verticalRange:null,horizontalRange:null,usePanoData:!1}),VisibleRangePlugin=class extends AbstractConfigurablePlugin{constructor(e,t){super(e,t)}init(){super.init(),this.autorotate=this.viewer.getPlugin("autorotate"),this.viewer.addEventListener(events.PanoramaLoadedEvent.type,this),this.viewer.addEventListener(events.PositionUpdatedEvent.type,this),this.viewer.addEventListener(events.ZoomUpdatedEvent.type,this),this.viewer.addEventListener(events.BeforeAnimateEvent.type,this),this.viewer.addEventListener(events.BeforeRotateEvent.type,this),this.setVerticalRange(this.config.verticalRange),this.setHorizontalRange(this.config.horizontalRange)}destroy(){this.viewer.removeEventListener(events.PanoramaLoadedEvent.type,this),this.viewer.removeEventListener(events.PositionUpdatedEvent.type,this),this.viewer.removeEventListener(events.ZoomUpdatedEvent.type,this),this.viewer.removeEventListener(events.BeforeAnimateEvent.type,this),this.viewer.removeEventListener(events.BeforeRotateEvent.type,this),super.destroy()}handleEvent(e){switch(e.type){case events.PanoramaLoadedEvent.type:this.config.usePanoData?this.setRangesFromPanoData():this.__moveToRange();break;case events.BeforeRotateEvent.type:case events.BeforeAnimateEvent.type:{const t=e,{rangedPosition:i,sidesReached:a}=this.__applyRanges(t.position,t.zoomLevel);(t.position||Object.keys(a).length)&&(t.position=i);break}case events.PositionUpdatedEvent.type:{const t=e.position,{sidesReached:i,rangedPosition:a}=this.__applyRanges(t);(i.left||i.right)&&this.autorotate?.isEnabled()?this.__reverseAutorotate(i.left,i.right):(Math.abs(t.yaw-a.yaw)>EPS||Math.abs(t.pitch-a.pitch)>EPS)&&this.viewer.dynamics.position.setValue(a);break}case events.ZoomUpdatedEvent.type:{const e=this.viewer.getPosition(),{rangedPosition:t}=this.__applyRanges(e);(Math.abs(e.yaw-t.yaw)>EPS||Math.abs(e.pitch-t.pitch)>EPS)&&this.viewer.dynamics.position.setValue(t);break}}}setVerticalRange(e){e&&2!==e.length&&(utils.logWarn("vertical range must have exactly two elements"),e=null),e?(this.config.verticalRange=e.map((e=>utils.parseAngle(e,!0))),this.config.verticalRange[0]>this.config.verticalRange[1]&&(utils.logWarn("vertical range values must be ordered"),this.config.verticalRange=[this.config.verticalRange[1],this.config.verticalRange[0]]),this.viewer.state.ready&&this.__moveToRange()):this.config.verticalRange=null}setHorizontalRange(e){e&&2!==e.length&&(utils.logWarn("horizontal range must have exactly two elements"),e=null),e?(this.config.horizontalRange=e.map((e=>utils.parseAngle(e))),this.viewer.state.ready&&this.__moveToRange()):this.config.horizontalRange=null}setRangesFromPanoData(){this.viewer.state.textureData.panoData&&(this.setVerticalRange(this.__getPanoVerticalRange()),this.setHorizontalRange(this.__getPanoHorizontalRange()))}__getPanoVerticalRange(){const e=this.viewer.state.textureData.panoData;if(e.croppedHeight===e.fullHeight)return null;{const t=t=>Math.PI*(1-t/e.fullHeight)-Math.PI/2;return[t(e.croppedY+e.croppedHeight),t(e.croppedY)]}}__getPanoHorizontalRange(){const e=this.viewer.state.textureData.panoData;if(e.croppedWidth===e.fullWidth)return null;{const t=t=>2*Math.PI*(t/e.fullWidth)-Math.PI;return[t(e.croppedX),t(e.croppedX+e.croppedWidth)]}}__moveToRange(){this.viewer.rotate(this.viewer.getPosition())}__applyRanges(e=this.viewer.getPosition(),t=this.viewer.getZoomLevel()){const i={yaw:e.yaw,pitch:e.pitch},a={},n=this.viewer.dataHelper.zoomLevelToFov(t),s=this.viewer.dataHelper.vFovToHFov(n);if(this.config.horizontalRange){const t=utils.clone(this.config.horizontalRange),n=t[0]>t[1]?t[1]+(2*Math.PI-t[0]):t[1]-t[0];if(n<=MathUtils.degToRad(s))t[0]=utils.parseAngle(t[0]+n/2),t[1]=t[0];else{const e=MathUtils.degToRad(s)/2;t[0]=utils.parseAngle(t[0]+e),t[1]=utils.parseAngle(t[1]-e)}t[0]>t[1]?e.yaw>t[1]&&e.yaw<t[0]&&(e.yaw>t[0]/2+t[1]/2?(i.yaw=t[0],a.left=!0):(i.yaw=t[1],a.right=!0)):e.yaw<t[0]?(i.yaw=t[0],a.left=!0):e.yaw>t[1]&&(i.yaw=t[1],a.right=!0)}if(this.config.verticalRange){const t=utils.clone(this.config.verticalRange),s=t[1]-t[0];if(s<=MathUtils.degToRad(n))t[0]=utils.parseAngle(t[0]+s/2,!0),t[1]=t[0];else{const e=MathUtils.degToRad(n)/2;t[0]=utils.parseAngle(t[0]+e,!0),t[1]=utils.parseAngle(t[1]-e,!0)}e.pitch<t[0]?(i.pitch=t[0],a.bottom=!0):e.pitch>t[1]&&(i.pitch=t[1],a.top=!0)}return{rangedPosition:i,sidesReached:a}}__reverseAutorotate(e,t){e&&this.autorotate.config.autorotateSpeed>0||t&&this.autorotate.config.autorotateSpeed<0||this.autorotate.reverse()}};VisibleRangePlugin.id="visible-range",VisibleRangePlugin.VERSION="5.10.1",VisibleRangePlugin.configParser=getConfig,VisibleRangePlugin.readonlyOptions=["horizontalRange","verticalRange"];export{VisibleRangePlugin};
//# sourceMappingURL=/sm/d23b611f05560035c86205fcb14296c0f89a183048c6952764c4ea0ac1fa1896.map